

<div class="instrumento-grid">
  <img src="https://claudio-arz.github.io/AeroDeck-HTML/Images/variometer/vert_speed_dial.png" alt="Variometer">
  <div class="aguja-variometer" id="aguja-variometer">
    <img src="https://claudio-arz.github.io/AeroDeck-HTML/Images/variometer/aguja.png" alt="Aguja">
  </div>
  <div id="variometer-value" class="instrument-center-label">--</div>
</div>


<script src="JS/functions_variometer.js"></script>
<script>
// WebSocket y sincronizaciÃ³n con el backend
let ws = new WebSocket("ws://" + location.hostname + ":81");

ws.onmessage = (msg) => {
  let data = {};
  try {
    data = JSON.parse(msg.data);
  } catch (e) {
    return;
  }
  // El backend debe enviar { variometer: valor }
  if (typeof data.variometer !== 'undefined') {
    updateVariometerAndValue(data.variometer);
  }
};

// Control deslizante para velocidad vertical
const variometerSlider = document.getElementById("variometer-slider");
const variometerSliderValue = document.getElementById("variometer-slider-value");
if (variometerSlider && variometerSliderValue) {
  variometerSlider.addEventListener("input", function() {
    variometerSliderValue.textContent = this.value;
    // Enviar valor al ESP32 por WebSocket
    if(ws.readyState === 1) {
      ws.send(JSON.stringify({ setVariometer: Number(this.value) }));
    }
    updateVariometerAndValue(Number(this.value));
  });
}
</script>